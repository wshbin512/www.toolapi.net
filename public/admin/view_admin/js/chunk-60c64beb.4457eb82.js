(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-60c64beb"],{"1cf9":function(t,e,s){"use strict";var i=s("855f"),a=s.n(i);a.a},"855f":function(t,e,s){},a9d3:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"chat-list"},[s("div",{staticClass:"head-box"},[s("div",{staticClass:"hd"},[s("div",{staticClass:"left-wrapper"},[s("img",{directives:[{name:"lazy",rawName:"v-lazy",value:t.kefuInfo.avatar,expression:"kefuInfo.avatar"}]}),s("div",{staticClass:"info",on:{click:function(e){t.isOnLine=!t.isOnLine}}},[s("div",[t._v(t._s(t.kefuInfo.nickname))]),s("div",{staticClass:"status"},[s("span",{staticClass:"doc",class:{off:!t.kefuInfo.online}}),s("span",[t._v(t._s(t.kefuInfo.online?"在线":"离线"))])])]),s("div",{directives:[{name:"show",rawName:"v-show",value:t.isOnLine,expression:"isOnLine"}],staticClass:"down-wrapper"},[s("div",{staticClass:"item",on:{click:function(e){return t.changOnline(1)}}},[s("span",{staticClass:"dot green"}),t._v("在线\n                        "),t.kefuInfo.online?s("span",{staticClass:"iconfont iconduihao"}):t._e()]),s("div",{staticClass:"item",on:{click:function(e){return t.changOnline(0)}}},[s("span",{staticClass:"dot"}),t._v("离线\n                        "),t.kefuInfo.online?t._e():s("span",{staticClass:"iconfont iconduihao"})])])]),s("div",{staticClass:"right-wrapper",on:{click:t.outLogin}},[t._m(0),s("div",{staticStyle:{"margin-left":"5px"}},[t._v("退出登录")])])]),s("div",{staticClass:"tab-box"},t._l(t.tabList,(function(e,i){return s("div",{staticClass:"tab-item",class:{on:t.tabCur==e.key},on:{click:function(s){return t.changeClass(e)}}},[t._v(t._s(e.title))])})),0),s("div",{staticClass:"search-box"},[s("Input",{attrs:{placeholder:"搜索用户名称"},on:{"on-enter":t.bindSearch},model:{value:t.searchTxt,callback:function(e){t.searchTxt=e},expression:"searchTxt"}})],1)]),t.list.length>0?s("div",{staticClass:"list-box"},[s("vue-scroll",{ref:"vs",attrs:{ops:t.ops},on:{"load-before-deactivate":t.handleBeforeDeactivate}},[t._l(t.list,(function(e,i){return s("div",{key:i,staticClass:"item",on:{click:function(s){return t.goPage(e)}}},[s("div",{staticClass:"left-wrapper"},[s("div",{staticClass:"img-box"},[s("img",{directives:[{name:"lazy",rawName:"v-lazy",value:e.avatar,expression:"item.avatar"}]}),s("div",{staticClass:"online",class:{on:e.online}})]),s("div",{staticClass:"info"},[s("div",{staticClass:"title"},[s("span",{staticClass:"line1"},[t._v(t._s(e.nickname))]),2==e.type?[s("span",{staticClass:"label"},[t._v("小程序")])]:t._e(),3==e.type?[s("span",{staticClass:"label h5"},[t._v("H5")])]:t._e(),1==e.type?[s("span",{staticClass:"label wx"},[t._v("公众号")])]:t._e(),0==e.type?[s("span",{staticClass:"label pc"},[t._v("PC端")])]:t._e()],2),1==e.message_type?s("div",{staticClass:"msg line1"},[t._v(t._s(e.message))]):t._e(),2==e.message_type?s("div",{staticClass:"msg"},[t._v("[表情]")]):t._e(),3==e.message_type?s("div",{staticClass:"msg"},[t._v("[图片]")]):t._e(),5==e.message_type?s("div",{staticClass:"msg"},[t._v("[商品]")]):t._e(),6==e.message_type?s("div",{staticClass:"msg"},[t._v("[订单]")]):t._e()])]),s("div",{staticClass:"right-wrapper"},[s("div",{staticClass:"time"},[t._v(t._s(t._f("toDay")(e.update_time)))]),e.mssage_num>0?s("span",{staticClass:"num"},[t._v(t._s(e.mssage_num))]):t._e()])])})),s("div",{staticClass:"slot-load",attrs:{slot:"load-deactive"},slot:"load-deactive"}),s("div",{staticClass:"slot-load",attrs:{slot:"load-active"},slot:"load-active"},[t._v("下滑加载更多")])],2)],1):s("empty",{attrs:{status:"3",msg:"暂无用户列表"}})],1)},a=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"icon-box"},[s("span",{staticClass:"iconfont icontuichu"})])}],n=s("c276"),o=s("49ea"),c=s("42e3"),r=s("7a1a"),l=s("6db4"),u=s("2f62"),f=s("8b1f");s("2d959");function d(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,i)}return s}function g(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?d(s,!0).forEach((function(e){h(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):d(s).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}function h(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}var p=s("16b0"),v=(p=new Audio(p),{name:"chat_list.vue",components:{HappyScroll:l["HappyScroll"],empty:f["a"]},data:function(){return{ops:{vuescroll:{mode:"slide",enable:!1,tips:{deactive:"Push to Load",active:"Release to Load",start:"Loading...",beforeDeactive:"Load Successfully!"},auto:!1,autoLoadDistance:0,pullRefresh:{enable:!1},pushLoad:{enable:!0,auto:!0,autoLoadDistance:10}},bar:{background:"#393232",opacity:".5",size:"2px"}},list:[],page:1,limit:10,isScroll:!0,searchTxt:"",isOpen:!0,kefuInfo:{},isOnLine:!1,tabCur:0,tabList:[{key:0,title:"用户列表"},{key:1,title:"游客列表"}],wsLogin:JSON.parse(sessionStorage.getItem("wsLogin")),pageWs:""}},filters:{toDay:function(t){if(!t)return"";var e=new Date,s=(e.getFullYear(),(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-"),i=(e.getDate()<10?"0"+e.getDate():e.getDate())+" ",a=(e.getHours()<10?"0"+e.getHours():e.getHours())+":",n=e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes();e.getSeconds(),e.getSeconds();return t=s+i+a+n,t}},created:function(){Promise.all([this.getKefuInfo(),this.getList()]),"undefined"==typeof this.bus.pageWs?(this.bus.pageWs=Object(o["a"])(!0),this.wsKefuLogin()):this.wsStart()},mounted:function(){window.addEventListener("beforeunload",(function(t){sessionStorage.setItem("wsLogin",!1)})),this.wsLogin=JSON.parse(sessionStorage.getItem("wsLogin"))||!1},methods:g({},Object(u["b"])("admin/account",["logout","logoutKefu"]),{wsKefuLogin:function(){var t=this,e=this,s=n["a"].cookies.kefuGet("token");this.bus.pageWs.then((function(i){!e.wsLogin&&s&&i.send({type:"kefu_login",data:s}),i.$on("success",(function(e){sessionStorage.setItem("wsLogin",!0),t.wsStart()})),i.$on("timeout",(function(e){setTimeout((function(){t.wsRestart()}),2e3)}))})).catch((function(e){setTimeout((function(){t.wsRestart()}),2e3)}))},wsStart:function(){var t=this,e=this;n["a"].cookies.kefuGet("token");this.bus.pageWs.then((function(s){s.$on("transfer",(function(e){if(e.recored.id){for(var s=!1,i=0;i<t.list.length;i++)e.recored.id==t.list[i].id&&(s=!0,t.$set(t.list,i,e.recored));s||t.list.unshift(e.recored)}})),s.$on("mssage_num",(function(s){if(s.num>0&&p.play(),s.recored.id){var i=!1;e.list.forEach((function(t,a,n){if(s.recored.id==t.id&&(i=!0,s.recored.is_tourist==e.tabCur)){var o=s.recored;n.splice(a,1),n.unshift(o)}})),i||s.recored.is_tourist==t.tabCur&&t.userList.unshift(s.recored),s.recored.is_tourist!=t.tabCur&&s.recored.id&&t.$Notice.info({title:t.tabCur?"用户发来消息啦！":"游客发来消息啦！"})}})),s.$on("timeout",(function(e){setTimeout((function(){t.wsRestart()}),2e3)}))})).catch((function(e){setTimeout((function(e){t.wsRestart()}),2e3)}))},wsRestart:function(){this.bus.pageWs=Object(o["a"])(!0),this.wsKefuLogin()},changeClass:function(t){this.tabCur!=t.key&&(this.tabCur=t.key,this.page=1,this.list=[],this.isScroll=!0,this.getList())},changOnline:function(t){this.kefuInfo.online=t,this.isOnLine=!1,this.bus.pageWs.then((function(e){e.send({type:"online",data:{online:t}})}))},getKefuInfo:function(){var t=this;Object(r["a"])().then((function(e){t.kefuInfo=e.data,window.document.title="".concat(e.data.site_name," - 消息列表")}))},getList:function(){var t=this;this.isScroll&&Object(c["F"])({nickname:this.searchTxt,page:this.page,limit:this.limit,is_tourist:this.tabCur}).then((function(e){t.isScroll=e.data.length>=t.limit,t.list=t.list.concat(e.data),t.page++,setTimeout((function(){t.$refs.vs.refresh()}),100)}))},outLogin:function(){var t=this;this.$Modal.confirm({title:"退出登录确认",content:"您确定退出登录当前账户吗？打开的标签页和个人设置将会保存。",onOk:function(){t.logoutKefu({confirm:!1,vm:t})},onCancel:function(){}})},bindSearch:function(t){this.page=1,this.list=[],this.isScroll=!0,this.getList()},goPage:function(t){this.$router.push({path:"mobile_chat",query:{toUid:t.to_uid,nickname:t.nickname,is_tourist:this.tabCur}})},handleBeforeDeactivate:function(t,e,s){this.getList(),s()}})}),m=v,b=(s("1cf9"),s("2877")),_=Object(b["a"])(m,i,a,!1,null,"7ef542d9",null);e["default"]=_.exports}}]);