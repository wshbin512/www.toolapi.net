(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-bdb787a8"],{"5fa7":function(t,e,i){"use strict";var a=i("fa7e"),n=i.n(a);n.a},6359:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"i-layout-page-header"},[i("PageHeader",{staticClass:"product_tabs",attrs:{"hidden-breadcrumb":""}},[i("div",{attrs:{slot:"title"},slot:"title"},[i("router-link",{attrs:{to:{path:"/admin/marketing/store_integral/index"}}},[i("Button",{staticClass:"mr20",attrs:{icon:"ios-arrow-back",size:"small"}},[t._v("返回")])],1),i("span",{staticClass:"mr20",domProps:{textContent:t._s(t.$route.params.id?"编辑积分商品":"添加积分商品")}})],1)])],1),i("Card",{staticClass:"ivu-mt",attrs:{bordered:!1,"dis-hover":""}},[i("Row",{staticClass:"mt30 acea-row row-middle row-center",attrs:{type:"flex"}},[i("Col",{attrs:{span:"23"}},[i("Form",{ref:"formValidate",staticClass:"form mt30",attrs:{model:t.formValidate,rules:t.ruleValidate,"label-width":t.labelWidth,"label-position":t.labelPosition},nativeOn:{submit:function(t){t.preventDefault()}}},[i("FormItem",{attrs:{label:"选择商品：",prop:"image_input"}},[i("div",{staticClass:"picBox",on:{click:t.changeGoods}},[t._l(t.goodsImg,(function(e,a){return i("div",{key:a,staticClass:"pictrue"},[e.image?i("img",{directives:[{name:"lazy",rawName:"v-lazy",value:e.image,expression:"item.image"}]}):t._e(),i("span",{staticClass:"iconfont icondel_1",on:{click:function(e){return e.stopPropagation(),t.bindDelete(a)}}})])})),i("div",{staticClass:"upLoad acea-row row-center-wrapper"},[i("Icon",{staticClass:"iconfonts",attrs:{type:"ios-camera-outline",size:"26"}})],1)],2)]),i("Col",{attrs:{type:"flex"}},[i("Col",{attrs:{span:"24"}},[i("FormItem",{attrs:{label:"规格选择："}},[i("Table",{staticClass:"mt25",attrs:{data:t.specsData,columns:t.columns,border:"","highlight-row":"",loading:t.loading},on:{"on-selection-change":t.changeCheckbox},scopedSlots:t._u([{key:"pic",fn:function(e){var a=e.row,n=e.index;return[i("div",{staticClass:"acea-row row-middle row-center-wrapper",on:{click:function(e){return t.modalPicTap("dan","danTable",n)}}},[a.pic?i("div",{staticClass:"pictrue pictrueTab"},[i("img",{directives:[{name:"lazy",rawName:"v-lazy",value:a.pic,expression:"row.pic"}]})]):i("div",{staticClass:"upLoad pictrueTab acea-row row-center-wrapper"},[i("Icon",{staticClass:"iconfont",attrs:{type:"ios-camera-outline",size:"21"}})],1)])]}}])})],1)],1),i("Col",{attrs:{span:"24"}},[i("FormItem",{attrs:{label:"上架状态：",props:"is_show","label-for":"is_show"}},[i("RadioGroup",{attrs:{"element-id":"is_show"},model:{value:t.formValidate.is_show,callback:function(e){t.$set(t.formValidate,"is_show",e)},expression:"formValidate.is_show"}},[i("Radio",{attrs:{label:0}},[t._v("关闭")]),i("Radio",{staticClass:"radio",attrs:{label:1}},[t._v("开启")])],1)],1)],1)],1),i("Col",{attrs:{span:"24"}},[i("FormItem",[i("Button",{directives:[{name:"show",rawName:"v-show",value:0!==t.current,expression:"current !== 0"}],staticClass:"submission mr15",attrs:{disabled:t.$route.params.id&&1===t.current},on:{click:t.step}},[t._v("上一步\n              ")]),i("Button",{staticClass:"submission",attrs:{disabled:t.submitOpen&&1===t.current,type:"primary"},domProps:{textContent:t._s("提交")},on:{click:function(e){return t.next("formValidate")}}})],1)],1)],1),t.spinShow?i("Spin",{attrs:{size:"large",fix:""}}):t._e()],1)],1)],1),i("Modal",{staticClass:"paymentFooter",attrs:{title:"商品列表",footerHide:"",scrollable:"",width:"900"},on:{"on-cancel":t.cancel},model:{value:t.modals,callback:function(e){t.modals=e},expression:"modals"}},[t.modals?i("goods-list",{ref:"goodslist",attrs:{ischeckbox:!0},on:{getProductId:t.getProductId}}):t._e()],1),i("Modal",{attrs:{width:"60%",scrollable:"","footer-hide":"",closable:"",title:"上传商品图","mask-closable":!1,"z-index":1},model:{value:t.modalPic,callback:function(e){t.modalPic=e},expression:"modalPic"}},[t.modalPic?i("uploadPictures",{attrs:{isChoice:t.isChoice,gridBtn:t.gridBtn,gridPic:t.gridPic},on:{getPic:t.getPic,getPicD:t.getPicD}}):t._e()],1)],1)},n=[],r=i("a34a"),o=i.n(r),s=i("2f62"),c=i("c4ad"),l=i("ef0d"),d=i("6625"),u=i.n(d),m=i("b0e7"),p=i("b7be");function f(t){return b(t)||h(t)||g()}function g(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function h(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function b(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}function w(t,e,i,a,n,r,o){try{var s=t[r](o),c=s.value}catch(l){return void i(l)}s.done?e(c):Promise.resolve(c).then(a,n)}function v(t){return function(){var e=this,i=arguments;return new Promise((function(a,n){var r=t.apply(e,i);function o(t){w(r,a,n,o,s,"next",t)}function s(t){w(r,a,n,o,s,"throw",t)}o(void 0)}))}}function x(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,a)}return i}function y(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?x(i,!0).forEach((function(e){C(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):x(i).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function C(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var _={name:"storeIntegralCreate",components:{UeditorWrap:l["a"],goodsList:c["default"],uploadPictures:m["a"],VueUeditorWrap:u.a},data:function(){return{loading:!1,goodsImg:[],productsId:[],submitOpen:!1,spinShow:!1,isChoice:"",current:0,modalPic:!1,grid:{xl:12,lg:20,md:24,sm:24,xs:24},grid2:{xl:8,lg:12,md:12,sm:24,xs:24},gridPic:{xl:6,lg:8,md:12,sm:12,xs:12},gridBtn:{xl:4,lg:8,md:8,sm:8,xs:8},myConfig:{autoHeightEnabled:!1,initialFrameHeight:500,initialFrameWidth:"100%",UEDITOR_HOME_URL:"/admin/UEditor/",serverUrl:""},modals:!1,modal_loading:!1,images:[],formValidate:{is_show:0,attrs:[]},templateList:[],timeList:[],columns:[],specsData:[],picTit:"",tableIndex:0,ruleValidate:{price:[{required:!0,type:"number",message:"请输入兑换积分",trigger:"blur"}],num:[{required:!0,type:"number",message:"请输入购买数量限制",trigger:"blur"}],once_num:[{required:!0,type:"number",message:"请输入单次购买数量限制",trigger:"blur"}]},copy:0}},computed:y({},Object(s["e"])("admin/layout",["isMobile"]),{labelWidth:function(){return this.isMobile?void 0:135},labelPosition:function(){return this.isMobile?"top":"right"}}),mounted:function(){this.$route.params.id&&(this.copy=this.$route.params.copy,this.current=1,this.getInfo())},methods:{productAttrs:function(t){var e=this;return this.loading=!0,new Promise((function(i,a){var n=e;Object(p["O"])(t.product_id,4).then((function(t){var a=t.data.info,r={type:"selection",width:60,align:"center"};n.specsData=n.specsData.concat(a.attrs),n.specsData.forEach((function(t,e){n.$set(n.specsData[e],"id",e)})),n.columns=a.header,n.columns.unshift(r),n.inputChange(a),i(),e.loading=!1})).catch((function(t){e.loading=!1,a(),n.$Message.error(t.msg)}))}))},inputChange:function(t){var e=this,i=[];t.header.forEach((function(t,e){1===t.type&&i.push({index:e,key:t.key,title:t.title})})),i.forEach((function(t,i){var a=t.title,n=t.key,r={title:a,key:n,align:"center",minWidth:120,render:function(t,i){return t("div",[t("InputNumber",{props:{min:0,precision:0,value:"price"===n?i.row.price:i.row.quota},on:{"on-change":function(t){"price"===n?i.row.price=t:i.row.quota=t,e.specsData[i.index]=i.row,e.formValidate.attrs&&e.formValidate.attrs.length&&e.formValidate.attrs.forEach((function(t,a){t.id===i.row.id&&e.formValidate.attrs.splice(a,1,i.row)}))}}})])}};e.columns.splice(t.index,1,r)}))},changeCheckbox:function(t){console.log(t),this.formValidate.attrs=t},getProductId:function(){var t=v(o.a.mark((function t(e){var i,a,n,r;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:console.log(e),i=0;case 2:if(!(i<this.goodsImg.length)){t.next=11;break}if(a=this.goodsImg[i],console.log(a.product_id,e.product_id),a.product_id!==e.product_id){t.next=8;break}return this.$Message.error("该商品已经添加"),t.abrupt("return");case 8:i++,t.next=2;break;case 11:this.modal_loading=!1,this.modals=!1,this.goodsImg=this.goodsImg.concat(e),n=0;case 15:if(!(n<e.length)){t.next=22;break}return r=e[n],t.next=19,this.productAttrs(r);case 19:n++,t.next=15;break;case 22:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),cancel:function(){this.modals=!1},onchangeTime:function(t){this.formValidate.section_time=t},getInfo:function(){var t=this;this.spinShow=!0,Object(p["C"])(this.$route.params.id).then(function(){var e=v(o.a.mark((function e(i){var a,n,r,s,c,l;return o.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:for(l in a=t,n=i.data.info,r={type:"selection",width:60,align:"center"},t.formValidate=n,t.columns=n.attrs.header,t.columns.unshift(r),t.specsData=n.attrs.value,a.specsData.forEach((function(t,e){a.$set(a.specsData[e],"id",e)})),s=n.attrs,c=[],n.attrs.value)n.attrs.value[l]._checked&&c.push(n.attrs.value[l]);a.formValidate.attrs=c,a.inputChange(s),t.spinShow=!1;case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){t.spinShow=!1,t.$Message.error(e.msg)}))},bindDelete:function(t){this.goodsImg[t].product_id;this.goodsImg.splice(t,1),this.loading=!0},next:function(t){var e=this,i=this;if(!this.formValidate.attrs.length)return i.$Message.error("请先选择商品规格");for(var a in i.formValidate.attrs)if(i.formValidate.attrs[a].quota<=0)return i.$Message.error("商品限量必须大于0");this.$refs[t].validate((function(t){if(!t)return!1;1==e.copy&&(e.formValidate.copy=1),e.formValidate.id=Number(e.$route.params.id)||0,e.submitOpen=!0,Object(p["A"])(e.formValidate).then(function(){var t=v(o.a.mark((function t(i){return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.submitOpen=!1,e.$Message.success(i.msg),setTimeout((function(){e.$router.push({path:"/admin/marketing/store_integral/index"})}),500);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch((function(t){e.submitOpen=!1,e.$Message.error(t.msg)}))}))},step:function(){this.current--},getContent:function(t){this.formValidate.description=t},modalPicTap:function(t,e,i){this.modalPic=!0,this.isChoice="dan"===t?"单选":"多选",this.picTit=e,this.tableIndex=i},getPic:function(t){switch(this.picTit){case"danFrom":this.formValidate.image=t.att_dir;break;default:this.formValidate.attrs&&this.formValidate.attrs.length&&this.$set(this.specsData[this.tableIndex],"_checked",!0),this.specsData[this.tableIndex].pic=t.att_dir}this.modalPic=!1},getPicD:function(t){var e=this;this.images=t,this.images.map((function(t){e.formValidate.images.push(t.att_dir),e.formValidate.images=e.formValidate.images.splice(0,10)})),this.modalPic=!1},handleRemove:function(t){this.images.splice(t,1),this.formValidate.images.splice(t,1)},changeGoods:function(){this.modals=!0},handleDragStart:function(t,e){this.dragging=e},handleDragEnd:function(t,e){this.dragging=null},handleDragOver:function(t){t.dataTransfer.dropEffect="move"},handleDragEnter:function(t,e){if(t.dataTransfer.effectAllowed="move",e!==this.dragging){var i=f(this.formValidate.images),a=i.indexOf(this.dragging),n=i.indexOf(e);i.splice.apply(i,[n,0].concat(f(i.splice(a,1)))),this.formValidate.images=i}},addCustomDialog:function(t){window.UE.registerUI("test-dialog",(function(t,e){var i=new window.UE.ui.Dialog({iframeUrl:"/admin/widget.images/index.html?fodder=dialog",editor:t,name:e,title:"上传图片",cssRules:"width:1200px;height:500px;padding:20px;"});this.dialog=i;var a=new window.UE.ui.Button({name:"dialog-button",title:"上传图片",cssRules:"background-image: url(../../../assets/images/icons.png);background-position: -726px -77px;",onclick:function(){i.render(),i.open()}});return a}),37,t)}}},k=_,P=(i("5fa7"),i("2877")),O=Object(P["a"])(k,a,n,!1,null,"29178408",null);e["default"]=O.exports},ef0d:function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("vue-ueditor-wrap",{staticStyle:{width:"90%"},attrs:{config:t.myConfig},on:{beforeInit:t.addCustomDialog},model:{value:t.contents,callback:function(e){t.contents=e},expression:"contents"}})],1)},n=[],r=i("6625"),o=i.n(r),s={name:"index",components:{VueUeditorWrap:o.a},props:{content:""},watch:{content:{handler:function(t){},deep:!0}},data:function(){return{contents:this.content,myConfig:{autoHeightEnabled:!1,initialFrameHeight:200,initialFrameWidth:"100%",UEDITOR_HOME_URL:"/admin/UEditor/",serverUrl:""}}},methods:{addCustomDialog:function(t){window.UE.registerUI("test-dialog",(function(t,e){var i=new window.UE.ui.Dialog({iframeUrl:"/admin/widget.images/index.html?fodder=dialog",editor:t,name:e,title:"上传图片",cssRules:"width:1200px;height:500px;padding:20px;"});this.dialog=i;var a=new window.UE.ui.Button({name:"dialog-button",title:"上传图片",cssRules:"background-image: url(../../../assets/images/icons.png);background-position: -726px -77px;",onclick:function(){i.render(),i.open()}});return a}),37,t)}},created:function(){}},c=s,l=i("2877"),d=Object(l["a"])(c,a,n,!1,null,"2fae1f2c",null);e["a"]=d.exports},fa7e:function(t,e,i){}}]);